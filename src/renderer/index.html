<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIBE IDE</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Menu Bar -->
        <div class="menu-bar">
            <div class="menu-title">VIBE IDE</div>
            <div class="menu-items">
                <div class="menu-item-wrapper">
                    <span class="menu-item" id="menuFile">File</span>
                    <div class="menu-dropdown" id="dropdownFile">
                        <div class="menu-dropdown-item" onclick="handleNewProject()">New Project</div>
                        <div class="menu-dropdown-item" onclick="handleOpenProject()">Open Project</div>
                        <div class="menu-dropdown-separator"></div>
                        <div class="menu-dropdown-item" onclick="handleNewFile()">New File</div>
                        <div class="menu-dropdown-item" onclick="handleOpenFile()">Open File</div>
                        <div class="menu-dropdown-item" onclick="handleSaveFile()">Save</div>
                        <div class="menu-dropdown-item" onclick="handleSaveFileAs()">Save As</div>
                        <div class="menu-dropdown-separator"></div>
                        <div class="menu-dropdown-item" onclick="window.electronAPI.closeWindow()">Exit</div>
                    </div>
                </div>
                <div class="menu-item-wrapper">
                    <span class="menu-item" id="menuEdit">Edit</span>
                    <div class="menu-dropdown" id="dropdownEdit">
                        <div class="menu-dropdown-item" onclick="document.execCommand('undo')">Undo</div>
                        <div class="menu-dropdown-item" onclick="document.execCommand('redo')">Redo</div>
                        <div class="menu-dropdown-separator"></div>
                        <div class="menu-dropdown-item" onclick="document.execCommand('cut')">Cut</div>
                        <div class="menu-dropdown-item" onclick="document.execCommand('copy')">Copy</div>
                        <div class="menu-dropdown-item" onclick="document.execCommand('paste')">Paste</div>
                    </div>
                </div>
                <div class="menu-item-wrapper">
                    <span class="menu-item" id="menuView">View</span>
                    <div class="menu-dropdown" id="dropdownView">
                        <div class="menu-dropdown-item" onclick="location.reload()">Reload</div>
                        <div class="menu-dropdown-item" onclick="location.reload(true)">Force Reload</div>
                        <div class="menu-dropdown-item" onclick="window.electronAPI && window.electronAPI.toggleDevTools && window.electronAPI.toggleDevTools()">Toggle Developer Tools</div>
                        <div class="menu-dropdown-separator"></div>
                        <div class="menu-dropdown-item" onclick="toggleLeftSidebar()">Toggle Left Sidebar</div>
                        <div class="menu-dropdown-item" onclick="toggleRightSidebar()">Toggle Right Sidebar</div>
                        <div class="menu-dropdown-item" onclick="togglePreview()">Toggle Preview</div>
                    </div>
                </div>
                <div class="menu-item-wrapper">
                    <span class="menu-item" id="menuHelp">Help</span>
                    <div class="menu-dropdown" id="dropdownHelp">
                        <div class="menu-dropdown-item" onclick="showKeyboardShortcuts()">‚å®Ô∏è Keyboard Shortcuts</div>
                        <div class="menu-dropdown-separator"></div>
                        <div class="menu-dropdown-item" onclick="if(window.electronAPI && window.electronAPI.showAbout) window.electronAPI.showAbout(); else alert('About VIBE IDE\n\nVersion 0.1.0\n\nBuilt with ‚ù§Ô∏è by FutureVision Labs');">About VIBE IDE</div>
                    </div>
                </div>
            </div>
            <div class="menu-right">
                <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
                    üåô
                </button>
                <button class="btn-small" id="btnUndo" title="Undo Last File Operation (Ctrl+Z)" disabled>‚Ü∂ Undo</button>
                <button class="btn-small" id="btnGenreRules" title="Manage Genre Rules">üß© Genre Rules</button>
                <button class="btn-small" id="btnBuildJournal" title="Build Project Journal (HTML)">üìù Build Journal</button>
                <button class="btn-small" id="btnExportJournal" title="Export Project Journal (PDF)">üìÑ Export PDF</button>
                <button class="btn-small" id="btnJournalSettings" title="Journal Settings">‚öôÔ∏è Settings</button>
            </div>
            <div class="window-controls">
                <button class="window-control minimize" id="windowMinimize" title="Minimize">‚àí</button>
                <button class="window-control maximize" id="windowMaximize" title="Maximize">‚ñ°</button>
                <button class="window-control close" id="windowClose" title="Close">√ó</button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Sidebar - File Tree (Phase 2) -->
            <div class="sidebar left-sidebar" id="leftSidebar">
                <div class="sidebar-header">
                    <h3>üìÅ Explorer</h3>
                    <button class="sidebar-toggle" id="toggleLeftSidebar" title="Toggle Sidebar">‚óÄ</button>
                </div>
                <div class="file-tree-search">
                    <input type="text" id="fileTreeSearch" placeholder="üîç Search files..." class="file-tree-search-input">
                </div>
                <div class="sidebar-content" id="fileTree">
                    <div class="file-tree" id="fileTreeContainer">
                        <div class="tree-item folder" data-path="/">
                            <span class="tree-icon">üìÅ</span>
                            <span class="tree-label">No project loaded</span>
                        </div>
                    </div>
                </div>
                <!-- Music & SFX Button -->
                <div class="file-tree-footer">
                    <button class="music-sfx-toggle" id="musicSfxToggle" title="Music & Sound Effects">
                        üéµ Music & SFX
                    </button>
                </div>
                <!-- Music & SFX Panel -->
                <div class="music-sfx-panel" id="musicSfxPanel">
                    <div class="music-sfx-header">
                        <h3>üéµ Music & Sound Effects</h3>
                        <button class="music-sfx-close" id="musicSfxClose" title="Close">√ó</button>
                    </div>
                    <div class="music-sfx-tabs">
                        <button class="music-sfx-tab active" data-tab="music">üéµ Music</button>
                        <button class="music-sfx-tab" data-tab="sfx">üîä Sound Effects</button>
                    </div>
                    <div class="music-sfx-content">
                        <div class="music-sfx-tab-content active" id="musicTab">
                            <div class="music-sfx-search">
                                <input type="text" id="musicSearch" placeholder="üîç Search for music..." class="music-sfx-search-input">
                                <button class="music-sfx-search-btn" id="musicSearchBtn">Search</button>
                            </div>
                            <div class="music-sfx-results" id="musicResults"></div>
                        </div>
                        <div class="music-sfx-tab-content" id="sfxTab">
                            <div class="music-sfx-search">
                                <input type="text" id="sfxSearch" placeholder="üîç Search for sound effects..." class="music-sfx-search-input">
                                <button class="music-sfx-search-btn" id="sfxSearchBtn">Search</button>
                            </div>
                            <div class="music-sfx-results" id="sfxResults"></div>
                        </div>
                    </div>
                </div>
                <!-- Context Menu -->
                <div class="context-menu" id="fileTreeContextMenu" style="display: none;">
                    <div class="context-menu-item" id="ctxNewFile">üìÑ New File</div>
                    <div class="context-menu-item" id="ctxNewFolder">üìÅ New Folder</div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" id="ctxRename">‚úèÔ∏è Rename</div>
                    <div class="context-menu-item" id="ctxDelete">üóëÔ∏è Delete</div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" id="ctxCopyPath">üìã Copy Path</div>
                </div>
            </div>
            <div class="resizer vertical-resizer" id="leftResizer"></div>

            <!-- Center - Editor Area -->
            <div class="editor-area">
                <div class="editor-tabs" id="editorTabs">
                    <div class="tab active" data-tab="welcome">Welcome</div>
                </div>
                <div class="editor-content" id="editorContent">
                    <!-- Markdown Editor Toolbar -->
                    <div id="mdToolbar" class="md-toolbar" style="display: none;">
                        <button class="md-toolbar-btn" data-action="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
                        <button class="md-toolbar-btn" data-action="italic" title="Italic (Ctrl+I)"><em>I</em></button>
                        <div class="md-toolbar-dropdown">
                            <button class="md-toolbar-btn" id="headingBtn" title="Heading">H</button>
                            <div class="md-toolbar-dropdown-menu" id="headingMenu">
                                <button class="md-toolbar-dropdown-item" data-action="h1">H1 - Large Title</button>
                                <button class="md-toolbar-dropdown-item" data-action="h2">H2 - Section</button>
                                <button class="md-toolbar-dropdown-item" data-action="h3">H3 - Subsection</button>
                                <button class="md-toolbar-dropdown-item" data-action="h4">H4 - Small Heading</button>
                            </div>
                        </div>
                        <div class="md-toolbar-separator"></div>
                        <button class="md-toolbar-btn" data-action="ulist" title="Bullet List">‚Ä¢ List</button>
                        <button class="md-toolbar-btn" data-action="olist" title="Numbered List">1. List</button>
                        <button class="md-toolbar-btn" data-action="link" title="Insert Link">üîó Link</button>
                        <button class="md-toolbar-btn" data-action="image" title="Insert Image">üñºÔ∏è Image</button>
                        <div class="md-toolbar-separator"></div>
                        <button class="md-toolbar-btn" data-action="code" title="Code Block">`</button>
                        <button class="md-toolbar-btn" data-action="quote" title="Quote">"</button>
                        <button class="md-toolbar-btn" data-action="hr" title="Horizontal Rule">‚îÄ</button>
                        <div class="md-toolbar-separator"></div>
                        <button class="md-toolbar-btn" id="mdPreviewToggle" title="Toggle Preview/Editor">üëÅÔ∏è Preview</button>
                    </div>
                    <!-- Monaco Editor Container -->
                    <div id="monacoEditor" style="display: none; width: 100%; height: 100%;"></div>
                    <!-- Markdown Preview Container -->
                    <div id="mdPreview" class="md-preview" style="display: none; width: 100%; height: 100%; overflow-y: auto; padding: 20px; background: var(--bg-primary); color: var(--text-primary);"></div>
                    
                    <!-- Welcome Screen -->
                    <div class="welcome-screen" id="welcomeScreen">
                        <img src="assets/vibe-ide-logo.jpg" alt="VIBE IDE Logo" class="welcome-logo">
                        <h1>üöÄ Welcome to VIBE IDE!</h1>
                        <p class="subtitle">Beginner-friendly coding environment with AI assistance</p>
                        
                        <div class="welcome-actions">
                            <button class="btn btn-primary" onclick="showNewProject()">
                                ‚ûï New Project
                            </button>
                            <button class="btn btn-secondary" onclick="showOpenProject()">
                                üìÇ Open Project
                            </button>
                        </div>

                        <div id="recentProjects" class="recent-projects" style="display: none;">
                            <h3>üìÅ Recent Projects</h3>
                            <div id="recentProjectsList" class="recent-projects-list"></div>
                        </div>

                        <div class="welcome-info">
                            <h3>üöÄ Quick Start</h3>
                            <ul>
                                <li>Create a new project from template</li>
                                <li>Start coding in the Monaco Editor</li>
                                <li>See live preview of your project</li>
                                <li>Get AI assistance from Cursy</li>
                            </ul>
                        </div>

                        <div class="phase-info">
                            <h3>üìã Current Phase: Foundation (Phase 1)</h3>
                            <p>‚úÖ Electron app structure created</p>
                            <p>‚úÖ Monaco Editor integrated</p>
                            <p>‚úÖ File tree navigation</p>
                            <p>‚úÖ Live preview functionality</p>
                            <p>‚úÖ Project templates system</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="resizer vertical-resizer" id="rightResizer"></div>
            <!-- Right Sidebar - AI Chat (Phase 6) -->
            <div class="sidebar right-sidebar" id="rightSidebar">
                <div class="sidebar-header">
                    <h3>ü§ñ AI Assistant</h3>
                    <div class="sidebar-header-actions">
                        <button class="btn-icon" id="toggleCursyViz" title="Toggle Cursy Visualization">üëÅÔ∏è</button>
                        <button class="btn-icon" id="clearChatBtn" title="Clear Chat History">üóëÔ∏è</button>
                        <button class="sidebar-toggle" id="toggleRightSidebar" title="Toggle Sidebar">‚ñ∂</button>
                    </div>
                </div>
                <!-- Cursy Visualization -->
                <div class="cursy-visualization" id="cursyVisualization" style="display: none;">
                    <div class="cursy-room" id="cursyRoom">
                        <!-- Isometric room built from tiles -->
                        <div class="room-container">
                            <!-- Floor tiles -->
                            <div class="room-floor-layer" id="roomFloorLayer"></div>
                            
                            <!-- Wall tiles -->
                            <div class="room-wall-layer" id="roomWallLayer"></div>
                            
                            <!-- Furniture layer (desks, chairs, etc.) -->
                            <div class="room-furniture-layer" id="roomFurnitureLayer"></div>
                            
                            <!-- Character layer -->
                            <div class="room-character-layer" id="roomCharacterLayer">
                                <img class="cursy-character" id="cursyCharacter" src="" alt="Cursy" style="display: none;">
                            </div>
                            
                            <!-- Props layer (plants, decorations, etc.) -->
                            <div class="room-props-layer" id="roomPropsLayer"></div>
                            
                            <!-- Hotspot layer (clickable areas on top of everything) -->
                            <div class="room-hotspot-layer" id="roomHotspotLayer"></div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-content">
                    <!-- Chat Messages Area -->
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-welcome">
                            <p>üëã Hey! I'm <strong>Cursy</strong>, your AI coding buddy!</p>
                            <p>I'm currently in <strong>offline mode</strong> - but I can still help with:</p>
                            <ul style="text-align: left; margin: 10px 0; padding-left: 20px;">
                                <li>Code explanations (functions, variables, loops, arrays)</li>
                                <li>Debugging tips</li>
                                <li>Getting started with projects</li>
                                <li>Learning the basics</li>
                            </ul>
                            <p>Try asking: <em>"How do I create a function?"</em> or <em>"What is a variable?"</em> üòä</p>
                            <p style="font-size: 0.9em; opacity: 0.7; margin-top: 10px;">üí° Full AI chat coming soon when API credits are configured!</p>
                        </div>
                    </div>
                    
                    <!-- Chat Input Area -->
                    <div class="chat-input-area">
                        <!-- Formatting Toolbar -->
                        <div class="formatting-toolbar">
                            <button class="format-btn" data-format="bold" title="Bold (Ctrl+B)"><b>B</b></button>
                            <button class="format-btn" data-format="italic" title="Italic (Ctrl+I)"><i>I</i></button>
                            <button class="format-btn" data-format="code" title="Inline Code (Ctrl+`)"><code>`</code></button>
                            <button class="format-btn" data-format="codeblock" title="Code Block">{ }</button>
                            <button class="format-btn" data-format="strikethrough" title="Strikethrough"><s>S</s></button>
                            <div class="toolbar-spacer"></div>
                            <label class="emoticon-toggle" title="Convert emoticons to emoji">
                                <input type="checkbox" id="emoticonConvert" checked>
                                <span>üòä</span>
                            </label>
                            <button class="emoji-btn" id="emojiPickerBtn" title="Insert Emoji">üòÄ</button>
                            <button class="emoji-btn" id="gifPickerBtn" title="Insert GIF">üé¨</button>
                        </div>
                        
                        <!-- GIF Picker Modal -->
                        <div class="gif-picker-modal" id="gifPickerModal" style="display: none;">
                            <div class="gif-picker-content">
                                <div class="gif-picker-header">
                                    <h3>üé¨ Search GIFs</h3>
                                    <button class="gif-picker-close" id="gifPickerClose">√ó</button>
                                </div>
                                <div class="gif-picker-search">
                                    <input type="text" id="gifSearchInput" placeholder="Search for GIFs..." class="gif-search-input">
                                    <button id="gifSearchBtn" class="btn btn-primary btn-small">Search</button>
                                </div>
                                <div class="gif-suggestions">
                                    <button class="gif-suggestion-btn" data-term="happy coding">üòä Happy Coding</button>
                                    <button class="gif-suggestion-btn" data-term="debugging">üêõ Debugging</button>
                                    <button class="gif-suggestion-btn" data-term="success">‚úÖ Success</button>
                                    <button class="gif-suggestion-btn" data-term="error">‚ùå Error</button>
                                    <button class="gif-suggestion-btn" data-term="thinking">ü§î Thinking</button>
                                    <button class="gif-suggestion-btn" data-term="celebration">üéâ Celebration</button>
                                </div>
                                <div class="gif-picker-results" id="gifPickerResults">
                                    <p class="gif-picker-placeholder">Search for GIFs or click a suggestion above</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Emoji Picker Popup -->
                        <div class="emoji-picker" id="emojiPicker" style="display: none;">
                            <div class="emoji-grid">
                                <button class="emoji-item" data-emoji="üòä">üòä</button>
                                <button class="emoji-item" data-emoji="üòÑ">üòÑ</button>
                                <button class="emoji-item" data-emoji="üòÖ">üòÖ</button>
                                <button class="emoji-item" data-emoji="üòÇ">üòÇ</button>
                                <button class="emoji-item" data-emoji="üéâ">üéâ</button>
                                <button class="emoji-item" data-emoji="üöÄ">üöÄ</button>
                                <button class="emoji-item" data-emoji="üí°">üí°</button>
                                <button class="emoji-item" data-emoji="‚ö†Ô∏è">‚ö†Ô∏è</button>
                                <button class="emoji-item" data-emoji="‚ùå">‚ùå</button>
                                <button class="emoji-item" data-emoji="‚úÖ">‚úÖ</button>
                                <button class="emoji-item" data-emoji="üéÆ">üéÆ</button>
                                <button class="emoji-item" data-emoji="üé®">üé®</button>
                                <button class="emoji-item" data-emoji="üî•">üî•</button>
                                <button class="emoji-item" data-emoji="üí™">üí™</button>
                                <button class="emoji-item" data-emoji="ü§î">ü§î</button>
                                <button class="emoji-item" data-emoji="üò§">üò§</button>
                                <button class="emoji-item" data-emoji="üéØ">üéØ</button>
                                <button class="emoji-item" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
                                <button class="emoji-item" data-emoji="üëç">üëç</button>
                                <button class="emoji-item" data-emoji="üëé">üëé</button>
                            </div>
                        </div>
                        
                        <!-- Text Input (WYSIWYG) -->
                        <div 
                            id="chatInput" 
                            class="chat-input wysiwyg-input" 
                            contenteditable="true"
                            data-placeholder="Type your message... (Shift+Enter for new line, Enter to send)"
                            spellcheck="true"
                        ></div>
                        <!-- Hidden input to store GIF code separately -->
                        <input type="hidden" id="chatGifCode" />
                        
                        <!-- Send Button -->
                        <div class="chat-actions">
                            <button class="btn btn-secondary btn-small" id="insertCodeContextBtn" title="Insert Selected Code">üìã Code</button>
                            <button class="btn btn-primary" id="chatSendBtn" title="Send (Enter)">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom - Preview Pane (Phase 3) -->
        <div class="resizer horizontal-resizer" id="previewResizer"></div>
        <div class="preview-pane" id="previewPane">
            <div class="preview-header">
                <span>üéÆ Live Preview</span>
                <div class="preview-controls">
                    <label style="margin-right:8px; color:#9fb0c6; font-size:12px; display:inline-flex; align-items:center; gap:6px;">
                        <input type="checkbox" id="autoBundleToggle" checked /> Auto-bundle
                    </label>
                    <button class="btn-small" id="previewOpenExternal" title="Open in external browser">üåê Open</button>
                    <button class="btn-small" id="bundleLogToggle" title="Toggle bundle log">üßæ Log</button>
                    <button class="btn-small" id="togglePreview" title="Toggle Preview">‚ñº</button>
                    <button class="btn-small" id="previewPlay" title="Play Preview">‚ñ∂Ô∏è Play</button>
                    <button class="btn-small" id="previewPause" title="Pause Preview" style="display: none;">‚è∏Ô∏è Pause</button>
                    <button class="btn-small" id="previewRestart" title="Restart Preview">üîÑ Restart</button>
                    <button class="btn-small" id="previewReload" title="Reload Preview">üîÑ Reload</button>
                </div>
            </div>
            <div id="bundleLog" style="display:none; font-family: monospace; font-size: 12px; color:#a6b3c4; background:#15181c; border-top:1px solid #2a2f36; padding:6px 10px; max-height:120px; overflow:auto;"></div>
            <div class="preview-content" id="previewContent">
                <div class="preview-loading" id="previewLoading">
                    <p>üì¶ No game loaded. Start coding to see preview!</p>
                </div>
                <iframe id="previewFrame" style="display: none; width: 100%; height: 100%; border: none;"></iframe>
                <canvas id="previewCanvas" style="display: none;"></canvas>
            </div>
        </div>
        
        <!-- Floating toggle button for collapsed right sidebar -->
        <button class="sidebar-float-toggle" id="rightSidebarFloatToggle" title="Show AI Assistant" style="display: none;">‚óÄ</button>
    </div>

    <!-- Genre Rule Editor Modal -->
    <div class="modal-overlay" id="genreModalOverlay" style="display:none;">
        <div class="modal genre-modal">
            <div class="genre-modal-header">
                <div>
                    <h3 id="genreModalTitle">Genre Rule Editor</h3>
                    <p id="genreModalSubtitle" class="genre-modal-subtitle">Inspect and customize genre guidance</p>
                </div>
                <button class="btn-icon" id="genreModalClose" title="Close">‚úñ</button>
            </div>
            <div class="genre-modal-body">
                <aside class="genre-sidebar">
                    <div class="genre-sidebar-header">
                        <span>Genres</span>
                        <button class="btn-small" id="genreNewBtn" title="Create new rule">Ôºã New</button>
                    </div>
                    <div class="genre-list" id="genreList"></div>
                </aside>
                <div class="genre-main">
                    <div class="genre-tabs">
                        <button class="genre-tab active" data-tab="form">Form View</button>
                        <button class="genre-tab" data-tab="json">Raw JSON</button>
                    </div>
                    <div class="genre-content" id="genreFormSection">
                        <div class="genre-form-grid">
                            <div class="form-field">
                                <label for="genreFieldName">Genre Name</label>
                                <input type="text" id="genreFieldName" placeholder="platformer">
                            </div>
                            <div class="form-field">
                                <label for="genreFieldVersion">Rule Version</label>
                                <input type="text" id="genreFieldVersion" placeholder="1.0.0">
                            </div>
                            <div class="form-field">
                                <label for="genreFieldPhaserVersion">Phaser Version</label>
                                <input type="text" id="genreFieldPhaserVersion" placeholder="3.x">
                            </div>
                            <div class="form-field">
                                <label for="genreFieldAuthor">Author</label>
                                <input type="text" id="genreFieldAuthor" placeholder="Your Name">
                            </div>
                            <div class="form-field full">
                                <label for="genreFieldDescription">Description</label>
                                <textarea id="genreFieldDescription" rows="3" placeholder="Overview of this genre"></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="genre-subsection" id="genreCommonPatternsStructured">
                                <div class="genre-subheader">
                                    <span>Structured Editor</span>
                                </div>
                                <div class="genre-patterns-grid" id="genrePatternsGrid">
                                    <div class="genre-pattern-card" data-pattern="player">
                                        <div class="genre-card-title">
                                            <span>Player</span>
                                        </div>
                                        <div class="genre-pattern-body">
                                            <div class="pattern-section" data-pattern-section="movement">
                                                <label>Movement Description</label>
                                                <input type="text" data-pattern-input="player.movement" placeholder="e.g. horizontal + jump">
                                            </div>
                                            <div class="pattern-section" data-pattern-section="physics">
                                                <div class="pattern-grid">
                                                    <label>Gravity</label>
                                                    <input type="number" data-pattern-input="player.physics.gravity" placeholder="800">
                                                    <label>Jump Speed</label>
                                                    <input type="number" data-pattern-input="player.physics.jumpSpeed" placeholder="-600">
                                                    <label>Max Speed</label>
                                                    <input type="number" data-pattern-input="player.physics.maxSpeed" placeholder="200">
                                                    <label>Friction</label>
                                                    <input type="number" step="0.1" data-pattern-input="player.physics.friction" placeholder="0.8">
                                                    <label>Bounce</label>
                                                    <input type="number" step="0.1" data-pattern-input="player.physics.bounce" placeholder="0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="genre-pattern-card" data-pattern="enemies">
                                        <div class="genre-card-title">
                                            <span>Enemies</span>
                                            <button class="btn-small" data-pattern-repeat-add="enemies.types">Ôºã Add Type</button>
                                        </div>
                                        <div class="genre-pattern-body">
                                            <label>Spawn Logic</label>
                                            <input type="text" data-pattern-input="enemies.spawnLogic" placeholder="patrol, chase, flying, etc.">
                                            <label>Types</label>
                                            <div class="tag-input" data-pattern-tags="enemies.types">
                                                <div class="tag-list" data-tag-list></div>
                                                <input type="text" data-tag-input placeholder="Add enemy type">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="genre-pattern-card" data-pattern="camera">
                                        <div class="genre-card-title">
                                            <span>Camera</span>
                                        </div>
                                        <div class="genre-pattern-body pattern-grid">
                                            <label>Follow Target</label>
                                            <input type="text" data-pattern-input="camera.follow" placeholder="player">
                                            <label>Deadzone</label>
                                            <input type="number" data-pattern-input="camera.deadzone" placeholder="50">
                                            <label>Bounds</label>
                                            <input type="text" data-pattern-input="camera.bounds" placeholder="levelBounds">
                                        </div>
                                    </div>
                                    <div class="genre-pattern-card" data-pattern="collectibles">
                                        <div class="genre-card-title">
                                            <span>Collectibles</span>
                                        </div>
                                        <div class="genre-pattern-body">
                                            <label>Collection Method</label>
                                            <input type="text" data-pattern-input="collectibles.collectionPattern" placeholder="overlap detection">
                                            <label>Types</label>
                                            <div class="tag-input" data-pattern-tags="collectibles.types">
                                                <div class="tag-list" data-tag-list></div>
                                                <input type="text" data-tag-input placeholder="coin, powerup, key">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-section">
                            <h4>AI Suggestions</h4>
                            <div class="form-field full">
                                <label for="genreFieldContext">Context</label>
                                <textarea id="genreFieldContext" rows="4" placeholder="Guidance for AI helper"></textarea>
                            </div>
                            <div class="genre-subsection">
                                <div class="genre-subheader">
                                    <span>Code Examples</span>
                                    <button class="btn-small" id="genreAddCodeExample">Ôºã Add Example</button>
                                </div>
                                <div id="genreCodeExamplesList" class="genre-code-examples"></div>
                            </div>
                            <div class="genre-subsection">
                                <div class="genre-subheader">
                                    <span>Common Bugs</span>
                                </div>
                                <div class="tag-input" id="genreCommonBugs">
                                    <div class="tag-list" data-tag-list></div>
                                    <input type="text" placeholder="Add a bug and press Enter" data-tag-input />
                                </div>
                            </div>
                            <div class="genre-subsection">
                                <div class="genre-subheader">
                                    <span>Performance Tips</span>
                                </div>
                                <div class="tag-input" id="genrePerformanceTips">
                                    <div class="tag-list" data-tag-list></div>
                                    <input type="text" placeholder="Add a tip and press Enter" data-tag-input />
                                </div>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-field full">
                                <label for="genreFieldValidation">Validation Rules (JSON)</label>
                                <textarea id="genreFieldValidation" class="code-textarea" rows="8"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="genre-content" id="genreJsonSection" style="display:none;">
                        <div id="genreJsonEditor" class="genre-json-editor"></div>
                    </div>
                </div>
            </div>
            <div class="genre-modal-footer">
                <div class="genre-status" id="genreStatus"></div>
                <div class="genre-actions">
                    <button class="btn-small" id="genreResetBtn" title="Reload last saved version">Reset</button>
                    <button class="btn-small" id="genreReloadBundledBtn" title="Load bundled default">Load Default</button>
                    <button class="btn-small" id="genreExportBtn" title="Export to JSON file">Export</button>
                    <button class="btn-small" id="genreDeleteBtn" title="Remove custom override">Delete Override</button>
                    <button class="btn-small primary" id="genreSaveBtn" title="Save custom override">Save Override</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Monaco Editor Loader -->
    <script>
        // IMPORTANT: Store Node.js require BEFORE Monaco loads and replaces it
        window.nodeRequire = require;
        
        // Load Monaco Editor using Node.js fs (since nodeIntegration: true)
        (function() {
            try {
                const fs = window.nodeRequire('fs');
                const path = window.nodeRequire('path');
                
                // Get the actual path to Monaco - use process.cwd() which should be the project root
                const appPath = process.cwd();
                const monacoLoaderPath = path.join(appPath, 'node_modules', 'monaco-editor', 'min', 'vs', 'loader.js');
                
                console.log('Attempting to load Monaco from:', monacoLoaderPath);
                console.log('Current working directory:', appPath);
                
                if (fs.existsSync(monacoLoaderPath)) {
                    console.log('Monaco loader.js found, reading...');
                    
                    // Read and execute Monaco loader
                    const loaderCode = fs.readFileSync(monacoLoaderPath, 'utf-8');
                    
                    // Create script element
                    const loaderScript = document.createElement('script');
                    loaderScript.textContent = loaderCode;
                    document.head.appendChild(loaderScript);
                    
                    console.log('Monaco loader.js executed');
                    
                    // Wait for loader to initialize
                    setTimeout(function() {
                        try {
                            if (typeof require === 'undefined' || !require.config) {
                                console.error('require.config not available');
                                document.getElementById('monacoEditor').innerHTML = '<div style="padding: 20px; color: #f48771;">require.config not available</div>';
                                return;
                            }
                            
                            // Configure Monaco paths - use absolute path
                            const monacoVsPath = path.join(appPath, 'node_modules', 'monaco-editor', 'min', 'vs').replace(/\\/g, '/');
                            require.config({ 
                                paths: { vs: monacoVsPath }
                            });
                            
                            console.log('Require config set, loading Monaco from:', monacoVsPath);
                            
                            // Load Monaco Editor main module
                            require(['vs/editor/editor.main'], function () {
                                console.log('‚úÖ Monaco Editor library loaded successfully');
                                
                                // Initialize Monaco Editor
                                setTimeout(function() {
                                    if (window.initMonacoEditor) {
                                        window.initMonacoEditor();
                                    } else {
                                        let attempts = 0;
                                        const checkInit = setInterval(function() {
                                            attempts++;
                                            if (window.initMonacoEditor) {
                                                clearInterval(checkInit);
                                                window.initMonacoEditor();
                                            } else if (attempts > 20) {
                                                clearInterval(checkInit);
                                                console.warn('initMonacoEditor not found after 2 seconds');
                                            }
                                        }, 100);
                                    }
                                }, 200);
                            }, function(err) {
                                console.error('Failed to load Monaco Editor module:', err);
                                const errorMsg = err && err.message ? err.message : String(err);
                                document.getElementById('monacoEditor').innerHTML = '<div style="padding: 20px; color: #f48771;">Failed to load Monaco Editor. Error: ' + errorMsg + '</div>';
                            });
                        } catch (error) {
                            console.error('Error in Monaco loading:', error);
                            document.getElementById('monacoEditor').innerHTML = '<div style="padding: 20px; color: #f48771;">Error: ' + error.message + '</div>';
                        }
                    }, 300);
                    
                } else {
                    console.error('Monaco loader.js not found at:', monacoLoaderPath);
                    document.getElementById('monacoEditor').innerHTML = '<div style="padding: 20px; color: #f48771;">Monaco Editor not found at: ' + monacoLoaderPath + '<br>Current dir: ' + appPath + '</div>';
                }
            } catch (error) {
                console.error('Error setting up Monaco loader:', error);
                document.getElementById('monacoEditor').innerHTML = '<div style="padding: 20px; color: #f48771;">Setup error: ' + error.message + '</div>';
            }
        })();
    </script>
    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Cursy Corner Modal -->
    <div id="cursyCornerModal" class="cursy-corner-modal" style="display: none;">
        <div class="modal-overlay" onclick="closeCursyCornerModal()"></div>
        <div class="modal-content-cursy">
            <div class="modal-header-cursy">
                <h2 id="modalTitleCursy">Cursy's Corner</h2>
                <button class="modal-close-cursy" onclick="closeCursyCornerModal()" title="Close">√ó</button>
            </div>
            <div class="modal-body-cursy" id="modalBodyCursy">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>
    
    <script src="renderer.js"></script>
</body>
</html>


